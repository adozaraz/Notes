# Построение разностных схем методом замены производных разностными отношениями. Схема Кранка-Николсона.
## Построение разностных схем методом замены производных разностными отношениями.
<span style="color: green"><b>+</b></span>
- Является самым простым и весьма универсальным
- Можно использовать при построении разностных схем для диф уравнений как с const, так и с var коэффициентами, а также для нелинейных диф уравнений.
<span style="color: red"><b>-</b></span>
- Качество таких схем может оказаться недостаточным для их успешного практического применения

<span style="color: yellow;"> `fas:Question` : нужно продемонстрировать алгоритм или показать на примере как работает?</span>
<span style="color: yellow;"> `fas:Question` : построение надо будет рассматривать для конкретного типа схемы или для обоих типов?</span>

**Пример применения**:
Краевая задача для уравнения теплопроводности с const коэффициентами
###### 4.1
$$
\begin{cases}
 & \frac{ \partial u(x,t) }{ \partial t } = \frac{ \partial^{2} u(x,t) }{ \partial x^{2} } + \varphi(x,t), 0\leq t\leq T, 0\leq x\leq l;  \\
 & u(x, 0)=\psi(x), 0 \leq x\leq l  \\
 & u(0, t)=\alpha(t), u(l,t)=\beta(t), 0<t\leq T
\end{cases}
$$
# 
Определим равномерную сетку как множество узлов $(x_{i}, t_{k})$, где
###### 4.2
$$
\begin{matrix}
x_{i}=ih_{x}, & i=\overline{0, I}, & h_{x}=\frac{l}{I} \\
	t_{k}=kh_{t},  & k=\overline{0, K}, & h_{t}=\frac{T}{K}
\end{matrix}
$$
# 
Запишем приближённые выражения для производных, входящих в задачу [[#4 1]]:
###### 4.3
$$
\frac{ \partial^{2} u(x_{i}, t_{k}) }{ \partial x^{2} } \approx \frac{u(x_{i+1}, t_{k})-2u(x_{i}, t_{k})+u(x_{i-1}, t_{k})}{h_{x}^2}
$$
###### 4.4
$$
\frac{ \partial u(x_{i},t_{k}) }{ \partial t } \approx \frac{u(x_{i}, t_{k+1} )-u(x_{i}, t_{k})}{h_{t}}
$$
###### 4.5
$$
\frac{ \partial u(x_{i}, t_{k}) }{ \partial t } \approx \frac{u(x_{i}, t_{k})-u(x_{i},t_{k-1})}{h_{t}}
$$
# 
Проводя дискретизацию задачи [[#4 1]], заменим все функции непрерывных аргументов $x,t$ их сеточными аналогами, а производные, входящие в уравнение [[#4 1]], разностными отношениями [[#4 3]] и [[#4 4]]. В результате получим так называемую **простейшую явную схему**
###### 4.6
$$
\begin{cases}
\frac{	u_{i}^{k+1}-u_{i}^k }{h_{t}}= \frac{u_{i+1}^k-2u_{i}^k+u_{i-1}^k}{h_{x}^2}+\varphi_{i}^k, i=\overline{1, I-1}, k=\overline{0, K-1}  \\
u_{i}^0=\psi_{i}, i=\overline{0, I} \\u_{0}^k=\alpha^k; u_{I}^k=\beta^k, k=\overline{1,K}
\end{cases}
$$
где:
$\varphi_{i}^k, \psi_{i}, \alpha^k,\beta^k$ - сеточные аналго соответствующих функций;
$u_{i}^k$ - искомая сеточная функция, которую будем рассматривать как некоторое приближение к решению $u$ задачи [[#4 1]].
# 
Очевидно, что схема [[#4 6]] представляет собой систему линейных уравнений, допускающую возможность рекуррентного вычисления сеточного решения $u_{i}^k$ для $k=1,2,\dots, K$ по явной формуле
$$
u_{i}^{k+1}=u_{i}^k+\gamma(u_{i+1}^k-2u_{i}^k+u_{i-1}^k)+h_{t}\varphi_{i}^k, \gamma=\frac{h_{t}}{h_{x}^2}
$$
Отметим, что схеме [[#4 6]] соответствует шаблон, приведённый ниже
![[Pasted image 20220609233559.png]]

Если при построении разностной схемы для задачи [[#4 1]] вместо формулы [[#4 4]] использовать формулу [[#4 5]] , то будет получена **простейшая неявная схема**
###### 4.7
$$
\begin{cases}
\frac{	u_{i}^{k}-u_{i}^{k-1} }{h_{t}}= \frac{u_{i+1}^k-2u_{i}^k+u_{i-1}^k}{h_{x}^2}+\varphi_{i}^k, i=\overline{1, I-1}, k=\overline{1, K}  \\
u_{i}^0=\psi_{i}, i=\overline{0, I} \\u_{0}^k=\alpha^k; u_{I}^k=\beta^k, k=\overline{1,K}
\end{cases}
$$
# 
Заметим, что схема [[#4 7]] представляет собой систему линейных уравнений с трёхдиагональной матрицей. Первое уравнение схемы [[#4 7]] запишем в следующем виде:
###### 4.8
$$
							-\gamma u_{i-1}^k+(1+2\gamma)u_{i}^k-\gamma u_{i+1}^k=u_{i}^{k-1}+h_{t}\varphi_{i}^k, i=1,2,\dots,I-1
$$
где $k=1,2,\dots,K; \gamma=\frac{h_{t}}{h_{x}^2}$.
# 
Положим в [[#4 8]] $i=1$ и учтём граничное условие $u_{0}^k=\alpha^k$. В результате получим уравнение 
###### 4.9
$$
(1+2\gamma)u_{1}^k-\gamma u_{2}^k=u_{1}^{k-1}+h_{t}\varphi_{1}^k+\gamma\alpha^k, k=1,2,\dots,K
$$
#
Аналогично, полагая в [[#4 8]] $i=I-1$ и используя граничное условие $u_{I}^k=\beta^k$, получим уравнение
###### 4.10
$$
						-\gamma u_{I-2}^k+(1+2\gamma)u_{I-1}^k=u_{I-1}^{k-1}+h_{t}\varphi_{I-1}^k+\gamma\beta^k, k=1,2,\dots,K
$$
# 
С учётом [[#4 8]]-[[#4 10]] систему уравнений [[#4 7]] можно записать в след векторно-матричном виде:
###### 4.11
$$
\begin{cases}
P \overline{u}^k=\overline{u}^{k-1}+\overline{q}^k, k=1,2,\dots,K; \\
\overline{u}^0=\overline{\psi}
\end{cases}
$$
где
$$
p=\begin{pmatrix}
1+2\gamma & -\gamma & 0 & \dots & 0 \\
-\gamma & 1+2\gamma & -\gamma & \dots & 0 \\
0 & -\gamma & 1+2\gamma  & \ddots & 0 \\
\vdots & \vdots & \ddots & \ddots & \vdots \\
0 & 0 & -\gamma & 1+2\gamma & -\gamma \\
0 & 0 & 0 & -\gamma & 1+2\gamma
\end{pmatrix}
$$
$$
\overline{u}^k=\begin{pmatrix}
u_{1}^k \\
u_{2}^k \\
\vdots \\
u_{I-1}^k
\end{pmatrix},
\overline{q}^k=\begin{pmatrix}
h_{t}\varphi_{1}^k+\gamma\alpha^k \\
h_{t}\varphi_{2}^k \\
\vdots \\
h_{t}\varphi_{I-2}^k \\
h_{t}\varphi_{I-1}^k+\gamma\beta^k
\end{pmatrix}
$$
$$
\overline{\psi}=(	\psi_{1},	\psi_{2},\dots,	\psi_{I-1})^T
$$
# 
Для решения системы [[#4 11]] следует использовать метод прогонки

Шаблон простейшей неявной схемы представлен на рисунке ниже
![[Pasted image 20220610001056.png]]
## Схема Кранка-Николсона.
![[Pasted image 20220610133739.png]]

Рассмотрим наряду с основными узлами шаблона вспомогательный узел $\left( x_{i}, t_{k}+\frac{h_{t}}{2} \right)$. Используя этот узел, запишем уравнение простейших явной и неявной схем для задачи [[#4 1]]:
###### 4.12
$$
\begin{align}
& \frac{\widetilde{u}_{i}-u_{i}^k}{\frac{h_{t}}{2}}=\frac{u_{i+1}^k-2u_{i}^k+u_{i-1}^k}{h_{x}^2}+\varphi_{i}^k  \\
& \frac{u_{i}^{k+1}-\widetilde{u}_{i}}{\frac{h_{t}}{2}}=\frac{u_{i+1}^{k+1}-2u_{i}^{k+1}+u_{i-1}^{k+1}}{h_{x}^2}+\varphi_{i}^{k+1}
\end{align}
$$
где $\widetilde{u}_{i}$ - значение решения во вспомогательном узле
# 
Если умножить каждое из уравнений [[#4 12]] на число $0.5$ и сложить, а также дописать начальное и граничные условия, то получим схему Кранка-Николсона:
###### 4.13
$$
\begin{cases}
\frac{	u_{i}^{k+1}-u_{i}^k}{h_{t}}=\frac{1}{2}(\Lambda_{x}^hu_{i}^{k+1}+\Lambda_{x}^hu_{i}^k)+\frac{1}{2}(\varphi_{i}^{k+1}+\varphi_{i}^k), & i=\overline{1,I-1}, k=\overline{0, K-1}; \\
u_{i}^0=\psi_{i}, & i=\overline{0,I}; \\
u_{0}^k=\alpha^k; u_{I}^k=\beta^k, & k=\overline{1, K}
\end{cases}
$$
где $\Lambda_{x}^hu_{i}^k=\frac{u_{i+1}^k-2u_{i}^k+u_{i-1}^k}{h_{x}^2}$
# 
Эта схема является неявной и для расчёта решения следует использовать метод прогонки. 
По аналогии с выводом схемы Кранка-Николсона можно получить схему более общего вида, если в качестве вспомогательного узла использовать узел $(x_{i}, t_{k}+\theta h_{t})$, где $0\leq\theta<1$. Эта схема запишется так:
###### 4.14
$$
\begin{cases}
\frac{u_{i}^{k+1}-u_{i}^k}{h_{t}}=(1-\theta)(\Lambda_{x}^hu_{i}^{k+1}+\varphi_{i}^{k+1})+\theta(\Lambda_{x}^hu_{i}^k+\varphi_{i}^k), & i=\overline{1, I-1}, k=\overline{0, K-1}; \\
u_{i}^0=\psi_{i}, & i=\overline{0, I} \\
u_{0}^k=\alpha^k; u_{i}^k=\beta^k, & k=\overline{1, K}
\end{cases}
$$
Называется **обобщённой неявной** или **схемой с весами**